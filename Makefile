.PHONY: init install dev build test lint type-check clean help start-work finish-work

# ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ
.DEFAULT_GOAL := help

# å…±é€šã®å¤‰æ•°
APP_DIR := app

# åˆæœŸåŒ–ï¼ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®åˆæœŸã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ï¼‰
init: ## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®åˆæœŸåŒ–ã‚’è¡Œã†
	@echo "ğŸš€ Initializing project..."
	@if ! command -v gh &> /dev/null; then \
		echo "ğŸ“¥ Installing GitHub CLI..."; \
		brew install gh; \
	fi
	@cd $(APP_DIR) && npm install
	@cd $(APP_DIR) && npm run prepare
	@echo "âœ¨ Project initialized successfully!"

# ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
install: ## ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹
	@echo "ğŸ“¦ Installing dependencies..."
	@cd $(APP_DIR) && npm install

# é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã®èµ·å‹•
dev: ## é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ã™ã‚‹
	@echo "ğŸ”¥ Starting development server..."
	@cd $(APP_DIR) && npm run dev

# ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ãƒ“ãƒ«ãƒ‰
build: ## ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ãƒ“ãƒ«ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹
	@echo "ğŸ—ï¸  Building for production..."
	@cd $(APP_DIR) && npm run build

# ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ
test: ## ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã™ã‚‹
	@echo "ğŸ§ª Running tests..."
	@cd $(APP_DIR) && npm run test

# ãƒªãƒ³ãƒˆã®å®Ÿè¡Œ
lint: ## ãƒªãƒ³ãƒˆã‚’å®Ÿè¡Œã™ã‚‹
	@echo "ğŸ” Running linter..."
	@cd $(APP_DIR) && npm run lint

# å‹ãƒã‚§ãƒƒã‚¯ã®å®Ÿè¡Œ
type-check: ## å‹ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œã™ã‚‹
	@echo "âœ… Running type check..."
	@cd $(APP_DIR) && npm run type-check

# ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
clean: ## ãƒ“ãƒ«ãƒ‰ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’å‰Šé™¤ã™ã‚‹
	@echo "ğŸ§¹ Cleaning up..."
	@cd $(APP_DIR) && rm -rf .next out node_modules
	@echo "âœ¨ Cleanup completed!"

# ä½œæ¥­é–‹å§‹
start-work: ## ä½œæ¥­ç”¨ãƒ–ãƒ©ãƒ³ãƒã‚’ä½œæˆã—ã€ä½œæ¥­ç’°å¢ƒã‚’æº–å‚™ã™ã‚‹
	@if [ -z "$(branch)" ]; then \
		echo "Usage: make start-work branch=<branch-name>"; \
		echo "Example: make start-work branch=feature/add-counter"; \
		exit 1; \
	fi
	@echo "ğŸš€ Starting work on branch: $(branch)..."
	@./scripts/start-work.sh "$(branch)"

# ä½œæ¥­çµ‚äº†
finish-work: ## PRã‚’ä½œæˆã—ã€ä½œæ¥­ã‚’çµ‚äº†ã™ã‚‹
	@if [ -z "$(title)" ]; then \
		echo "Usage: make finish-work title=<pr-title>"; \
		echo "Example: make finish-work title=\"feat: ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼æ©Ÿèƒ½ã®è¿½åŠ \""; \
		exit 1; \
	fi
	@echo "ğŸ Finishing work with PR title: $(title)..."
	@if [ ! -f .work/pr-draft.md ]; then \
		echo "âš ï¸  PR draft file not found at .work/pr-draft.md"; \
		exit 1; \
	fi
	@echo "ğŸ“¤ Creating PR..."
	@gh pr create --repo $$(git remote get-url origin | sed 's/.*://; s/\.git$$//') --title "$(title)" --body-file .work/pr-draft.md
	@echo "âœ¨ PR created successfully!"

# ãƒ˜ãƒ«ãƒ—ã®è¡¨ç¤º
help: ## ã“ã®ãƒ˜ãƒ«ãƒ—ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºã™ã‚‹
	@echo "Usage: make [target]"
	@echo ""
	@echo "Targets:"
	@grep -E '^[a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | sort | awk 'BEGIN {FS = ":.*?## "}; {printf "  \033[36m%-15s\033[0m %s\n", $$1, $$2}' 
