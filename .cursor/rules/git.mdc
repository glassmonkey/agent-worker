---
description: Gitの操作に関するルールを定義します
globs: ["**/*"]
---

# Git操作ルール

## 1. 目的

本ルールは以下の目的のために定義されています：

1. 変更履歴の適切な管理
   - コードの変更履歴の明確化
   - 変更理由の追跡可能性確保
   - バージョン管理の適正化

2. チーム開発の効率化
   - 並行開発の円滑な実施
   - コンフリクトの最小化
   - マージプロセスの標準化

3. 品質管理の強化
   - コードレビューの効率化
   - 問題発生時の原因特定
   - ロールバックの容易性確保

## ブランチ管理

### 基本ルール

* mainブランチで指示があった場合指示内容に応じて新しくブランチを作成し、checkoutを行う。mainブランチ上でコード改変を含めて、git操作を行うことも禁止です。
* ブランチ名は以下の命名規則に従うこと：
  * 機能追加: `feat/機能名`
  * バグ修正: `fix/修正内容`
  * ドキュメント: `docs/内容`
  * リファクタリング: `refactor/内容`
  * テスト追加・修正: `test/内容`

### ブランチ作成手順

mainブランチから新規ブランチを作成する際は、以下の手順を必ず実施すること：

1. 現在のブランチを確認（`git branch --show-current`）
2. mainブランチに移動（`git checkout main`）
3. リモートの最新変更を取得（`git fetch origin main`）
4. ローカルのmainブランチを最新に更新（`git pull --rebase origin main`）
5. 新規ブランチを作成（`git checkout -b <branch-name>`）
6. 作業ブランチに切り替わっていることを確認

### 作業開始前の確認事項

作業開始前に必ず以下を確認すること：

1. 現在のブランチがmainでないこと
2. 作業ブランチが最新のmainから作成されていること
3. mainブランチの最新状態を確認
   ```bash
   git fetch origin main
   git checkout main
   git pull --rebase origin main
   git checkout -
   git rebase main
   ```

## コミット管理

### 基本ルール

* 指示内容に応じてコード改変を行いcommitを実施する。commitの粒度はconversional commitに準拠する。
* 作業完了の指示があるまで同一ブランチ上で作業をおこなってください。
* レビュー指摘事項の修正は、新しいブランチを作成せず、同一ブランチ上で修正を続けること。
* 全てのコード変更は必ずcommitすること
* プッシュ前に必ず振り返りを実施し、その内容をコミットすること
  - 振り返りは[振り返りと改善ルール](mdc:retrospective.mdc)に従って実施
  - 振り返りのコミットは`docs(retrospective): add retrospective for <作業内容>`の形式で行う

### コミットメッセージフォーマット

コミットメッセージは以下の形式に従うこと：

```
<type>(<scope>): <description>

[optional body]

[optional footer]
```

#### 各要素の説明

- type: feat, fix, docs, style, refactor, test, chore のいずれか
- scope: 変更の範囲（オプション）
- description: 変更内容の要約（命令形で）
- body: 変更の詳細な説明（オプション）
- footer: Breaking changes や Issue への参照（オプション）

## PR作成前のGit操作

### mainブランチとの同期

* PR作成前に、mainブランチの最新状態を確認し、作業ブランチを同期すること
  ```bash
  # mainブランチの最新状態を取得
  git fetch origin main
  
  # 現在のブランチにmainの変更を取り込む
  git rebase origin/main
  ```

* コンフリクトが発生した場合は、以下の手順で解決：
  1. コンフリクトファイルを確認（`git status`）
  2. コンフリクトを解決
  3. 解決したファイルをステージング（`git add <file>`）
  4. rebaseを続行（`git rebase --continue`）
  5. 必要に応じてテストを実行し、動作確認

### コミットの整理

* PR作成前に、ブランチ上のcommitを整理すること
* 類似した変更や手戻りのあったコミットは一つにまとめること
* 全てのコミットメッセージがconventional commitsに従っていることを確認

### リモートへのプッシュ

* プッシュ前に必ず以下の手順を実施すること：
  1. mainブランチの最新変更を取り込む
     ```bash
     git fetch origin main
     git rebase origin/main
     ```
  2. コンフリクトが発生した場合は解消する
  3. テストを実行し、全てのテストが通過することを確認
  4. 振り返りを実施し、その内容をコミット

* 上記の手順が完了したら、以下のコマンドでリモートにプッシュ：
  ```bash
  git push -u origin <branch-name>
  ```

* プッシュ後に追加の修正が必要になった場合：
  1. 修正を実施しコミット
  2. 再度mainブランチの変更を取り込む
  3. テストを実行
  4. 必要に応じて振り返りを更新
  5. プッシュ

## 作業完了時のGit操作

作業完了の指示があった場合のみ、以下の手順を実施してください：

1. mainブランチに移動
   ```bash
   git checkout main
   ```

2. 最新の変更を取得
   ```bash
   git pull origin main
   ```

## Issue管理

### Issue作成の基準

以下の場合には必ずIssueを作成すること：

1. バグの発見時
   - 再現手順が明確な場合
   - 一時的な回避策がある場合
   - 本質的な解決が必要な場合

2. 技術的負債の発見時
   - パフォーマンスの問題
   - コードの重複や複雑性
   - 依存関係の問題

3. 改善提案時
   - プロセスの改善案
   - コードの改善案
   - ドキュメントの改善案

### Issueの作成手順

1. Issue作成前の確認
   - 類似のIssueが存在しないか確認
   - 関連するPRやコミットを確認
   - 影響範囲を評価

2. Issue本文の作成
   ```markdown
   ## 概要
   
   問題や提案の概要を簡潔に記載
   
   ## 詳細
   
   1. 具体的な問題点や改善点
      - 原因や背景
      - 影響範囲
      - 再現手順（バグの場合）
   
   2. 対応案
      - 具体的な解決方法
      - 代替案がある場合はそれも記載
      - 予想される副作用
   
   ## その他
   - 関連するIssueやPR
   - 参考情報
   - 注意事項
   ```

3. ラベルとマイルストーンの設定
   - 適切なラベルを付与（bug, enhancement, documentation等）
   - 優先度を設定（high, medium, low）
   - 必要に応じてマイルストーンを設定

### Issue管理プロセス

1. 作業開始時
   - Issueに対応するブランチを作成
   - ブランチ名は`<type>/<issue-number>-<description>`の形式
   - Issueにブランチ名をコメント

2. 作業中
   - 進捗状況を定期的にコメント
   - ブロッカーがある場合は早期に報告
   - 関連する新しい問題を発見した場合は別Issueとして切り出す

3. 作業完了時
   - PRの作成
   - PRでIssueを参照（`Closes #<issue-number>`）
   - Issueのステータスを更新

### Issue更新のタイミング

以下のタイミングで必ずIssueを更新すること：

1. 新しい情報や知見が得られた時
   - 原因の特定
   - 解決方法の発見
   - 影響範囲の変更

2. 状況の変化があった時
   - 優先度の変更
   - ブロッカーの発生
   - 依存関係の変更

3. マイルストーンの変更時
   - スケジュールの変更
   - スコープの変更
   - 担当者の変更 