---
description: プルリクエスト作成時の手順を定義します
globs: ["**/*"]
---

# プルリクエスト作成ルール

## 1. 目的

本ルールは以下の目的のために定義されています：

1. コードレビューの効率化
   - レビュー範囲の明確化
   - レビュー基準の統一
   - フィードバックの質の向上

2. 品質管理の強化
   - 変更内容の妥当性確認
   - テストの網羅性確認
   - ドキュメントの整備

3. 開発プロセスの標準化
   - 作業完了の定義の明確化
   - マージ基準の統一
   - 変更履歴の追跡性確保

## PRの作成基準

### 作成タイミング

1. 機能追加・修正の完了時
   - 実装が完了し、動作確認済みの場合
   - テストが追加・更新済みの場合
   - ドキュメントが更新済みの場合

2. レビュー依頼時
   - コードの品質が確認済みの場合
   - 変更内容が明確に説明されている場合

### 事前確認事項

1. ブランチの状態確認
   - mainブランチの最新変更を取り込み済み
   - コンフリクトが解消済み
   - 不要なファイルが含まれていないか確認

2. 品質確認
   - 全てのテストが通過
   - リンター警告の解消
   - 動作確認の完了

## PR作成手順

### 1. PR本文の作成

テンプレートは`.work/templates/pr_template.md`に配置されています。以下の内容で作成してください：

```markdown
# 概要

変更内容を簡潔に説明

## 変更理由

なぜこの変更が必要なのかを説明

## 変更内容

- [ ] 具体的な変更点A
- [ ] 具体的な変更点B
- [ ] 具体的な変更点C

## チェックリスト

### コード品質
- [ ] 適切なコメントが追加されている
- [ ] 不要なコメントアウトやデバッグコードが削除されている
- [ ] 命名が適切で理解しやすい
- [ ] コードの重複がない
- [ ] エラーハンドリングが適切に実装されている

### テストと検証
- [ ] ユニットテストが追加・更新されている
- [ ] 全てのテストが通過している
- [ ] エッジケースのテストが考慮されている
- [ ] 手動での動作確認が完了している

### ドキュメント
- [ ] 必要なドキュメントが更新されている
- [ ] APIドキュメントが更新されている（必要な場合）
- [ ] 変更による影響範囲が文書化されている

### ブランチ管理
- [ ] mainブランチの変更が取り込まれている
- [ ] コンフリクトが解消されている
- [ ] コミット履歴が整理されている

### セキュリティ
- [ ] セキュリティ上の懸念がないことを確認
- [ ] 機密情報が含まれていないことを確認
- [ ] 適切なアクセス制御が実装されている（必要な場合）

### パフォーマンス
- [ ] パフォーマンスへの影響を考慮している
- [ ] 必要に応じてパフォーマンステストを実施している

## その他

- 関連する課題: #issue_number
- 参考情報
- 注意事項
```

### 2. レビュー依頼

1. レビュアーの選定
   - コードオーナーを含める
   - 関連する機能の担当者を含める
   - 必要に応じて複数のレビュアーを設定

2. レビュー範囲の明確化
   - 重点的にレビューして欲しい箇所の明示
   - 変更による影響範囲の説明
   - テスト項目の説明

## レビュー対応

### 1. レビューコメントへの対応

- 各コメントに対する対応方針を明確に説明
- 修正が完了したらResolveする
- 議論が必要な場合は関係者をメンションする

### 2. 修正の反映

- レビュー指摘に基づく修正は同一ブランチで実施
- 修正後は再度テストを実行
- 修正内容を分かりやすくコミットメッセージに記載

### 3. 再レビュー依頼

- 修正内容の説明をPRコメントに追記
- レビュアーに再レビューを依頼
- 必要に応じて修正箇所の説明を追加

## マージ条件

### 必須条件

1. レビュー承認
   - 必要数のレビュー承認を得ている
   - 全ての指摘事項が解決済み

2. CI/テスト
   - 全てのテストが通過
   - リンター警告が解消済み

3. ブランチの状態
   - mainブランチと同期済み
   - コンフリクトが解消済み

### 追加確認事項

1. ドキュメント
   - 必要なドキュメントが更新済み
   - APIドキュメントが更新済み（必要な場合）

2. 変更履歴
   - コミット履歴が整理済み
   - コミットメッセージが適切

3. デプロイ
   - デプロイ手順が明確
   - 必要な環境変数が設定済み 